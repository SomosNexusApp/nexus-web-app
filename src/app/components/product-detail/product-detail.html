<div *ngIf="loading" class="loading">
  <p>Cargando...</p>
</div>

<div *ngIf="!loading" class="detail-container">
  <!-- GalerÃ­a de imÃ¡genes -->
  <div class="gallery">
    <div class="imagen-principal">
      <img [src]="imagenActual" [alt]="tipo === 'oferta' ? oferta?.titulo : producto?.titulo" />
    </div>
    
    <div class="miniaturas">
      <img 
        *ngIf="tipo === 'oferta' && oferta"
        [src]="oferta.imagenPrincipal" 
        (click)="cambiarImagen(oferta.imagenPrincipal)"
        [class.active]="imagenActual === oferta.imagenPrincipal"
      />
      <img 
        *ngFor="let img of (tipo === 'oferta' ? oferta?.galeriaImagenes : producto?.galeriaImagenes)"
        [src]="img"
        (click)="cambiarImagen(img)"
        [class.active]="imagenActual === img"
      />
    </div>
  </div>

  <!-- InformaciÃ³n del producto/oferta -->
  <div class="info">
    <h1>{{ tipo === 'oferta' ? oferta?.titulo : producto?.titulo }}</h1>
    
    <!-- Precio -->
    <div class="precio-box">
      <div *ngIf="tipo === 'oferta' && oferta" class="precio-oferta">
        <span class="precio-actual">{{ oferta.precioOferta | currency:'EUR' }}</span>
        <span class="precio-original">{{ oferta.precioOriginal | currency:'EUR' }}</span>
        <span class="descuento">
          -{{ ((oferta.precioOriginal - oferta.precioOferta) / oferta.precioOriginal * 100) | number:'1.0-0' }}%
        </span>
      </div>
      
      <div *ngIf="tipo === 'producto' && producto" class="precio-producto">
        <span class="precio">{{ producto.precio | currency:'EUR' }}</span>
      </div>
    </div>

    <!-- DescripciÃ³n -->
    <div class="descripcion">
      <h3>DescripciÃ³n</h3>
      <p>{{ tipo === 'oferta' ? oferta?.descripcion : producto?.descripcion }}</p>
    </div>

    <!-- MÃ©tricas (solo ofertas) -->
    <div *ngIf="tipo === 'oferta' && oferta" class="metricas">
      <span class="metric">âš¡ {{ (oferta.sparkCount || 0) - (oferta.dripCount || 0) }} Spark</span>
      <span class="metric">ğŸ‘ï¸ {{ oferta.numeroVistas || 0 }} vistas</span>
      <span class="metric">ğŸ’¬ {{ oferta.numeroComentarios || 0 }} comentarios</span>
    </div>

    <!-- Acciones -->
    <div class="acciones">
      <button *ngIf="tipo === 'oferta'" class="btn-primary" (click)="irAOferta()">
        ğŸ”— Ir a la oferta
      </button>
      <button *ngIf="tipo === 'producto'" class="btn-primary" (click)="contactarVendedor()">
        ğŸ’¬ Contactar vendedor
      </button>
      <button *ngIf="tipo === 'oferta'" class="btn-secondary" (click)="darSpark()">
        âš¡ Dar Spark
      </button>
    </div>
  </div>
</div>